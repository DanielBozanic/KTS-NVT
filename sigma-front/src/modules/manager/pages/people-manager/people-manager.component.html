<!DOCTYPE html>
<div>
  <div fxLayout="row">
    <div class="add-button">
      <button
        id="add-employee-btn"
        (click)="openAddDialog()"
        mat-raised-button
        color="primary"
      >
        Add
      </button>
    </div>
  </div>
  <div>
    <mat-card class="table-card">
      <div class="data-table">
        <form>
          <mat-progress-bar
            mode="indeterminate"
            *ngIf="isLoading"
          ></mat-progress-bar>
          <table mat-table [dataSource]="employeeDataSource">
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef class="column-name">
                Name
              </th>
              <td mat-cell *matCellDef="let element" class="column-name">
                {{ element.name }}
              </td>
            </ng-container>
            <ng-container matColumnDef="paymentBigDecimal">
              <th mat-header-cell *matHeaderCellDef class="column-payment">
                Payment
              </th>
              <td mat-cell *matCellDef="let element" class="column-payment">
                {{ element.paymentBigDecimal }}
              </td>
            </ng-container>
            <ng-container matColumnDef="type">
              <th mat-header-cell *matHeaderCellDef class="column-job">Job</th>
              <td mat-cell *matCellDef="let element" class="column-job">
                {{ element.type }}
              </td>
            </ng-container>
            <ng-container matColumnDef="code">
              <th mat-header-cell *matHeaderCellDef class="column-code">
                Code
              </th>
              <td mat-cell *matCellDef="let element" class="column-code">
                {{ element.code }}
              </td>
            </ng-container>
            <ng-container matColumnDef="edit">
              <th
                mat-header-cell
                *matHeaderCellDef
                class="column-edit-button"
              ></th>
              <td mat-cell *matCellDef="let element" class="column-edit-button">
                <button
                  (click)="openEditDialog(element)"
                  mat-raised-button
                  color="primary"
                >
                  Edit
                </button>
              </td>
            </ng-container>
            <ng-container matColumnDef="delete">
              <th
                mat-header-cell
                *matHeaderCellDef
                class="column-delete-button"
              ></th>
              <td
                mat-cell
                *matCellDef="let element"
                class="column-delete-button"
              >
                <button
                  (click)="deleteEmployee(element.id)"
                  mat-raised-button
                  color="warn"
                >
                  Delete
                </button>
              </td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="displayedColumnsPeople"></tr>
            <tr
              mat-row
              *matRowDef="let row; columns: displayedColumnsPeople"
            ></tr>
          </table>
          <mat-paginator
            #paginatorEmployee
            [pageSizeOptions]="pageSizeOptions"
            [pageIndex]="currentPage"
            [pageSize]="pageSize"
            [length]="totalRows"
            showFirstLastButtons
            (page)="pageChanged($event)"
          ></mat-paginator>
        </form>
      </div>
    </mat-card>
  </div>
  <ng-template #addEmployeeDialog>
    <form [formGroup]="addEmployeeForm" class="add-employee-form">
      <mat-form-field class="field-width">
        <mat-label>Name</mat-label>
        <input
          id="add-employee-name-field"
          type="text"
          matInput
          placeholder="Name"
          formControlName="name"
        />
        <mat-error
          id="add-employee-name-field-error-msg"
          *ngIf="hasError('name', 'required')"
          >Name is required!</mat-error
        >
      </mat-form-field>
      <mat-form-field class="field-width">
        <mat-label>Payment</mat-label>
        <input
          id="add-employee-payment-field"
          type="number"
          min="0"
          matInput
          placeholder="Payment"
          formControlName="paymentBigDecimal"
          (input)="checkPayment()"
        />
        <mat-error
          id="add-employee-payment-field-required-error-msg"
          *ngIf="hasError('paymentBigDecimal', 'required')"
          >Payment is required!</mat-error
        >
        <mat-error
          id="add-employee-payment-field-negative-number-error-msg"
          *ngIf="
            paymentBigDecimalAddForm?.invalid &&
            !hasError('paymentBigDecimal', 'required')
          "
          >Payment must be a postive number!</mat-error
        >
      </mat-form-field>
      <mat-form-field class="field-width">
        <mat-label>Job</mat-label>
        <mat-select id="job-field" formControlName="type">
          <mat-option [id]="job" *ngFor="let job of jobs" [value]="job">{{
            job
          }}</mat-option>
        </mat-select>
      </mat-form-field>
    </form>
    <button
      id="add-employee-btn-dialog"
      (click)="addEmployee()"
      [disabled]="addEmployeeForm.invalid"
      mat-raised-button
      color="primary"
    >
      Add new worker
    </button>
  </ng-template>
  <ng-template #editEmployeeDialog>
    <form [formGroup]="editEmployeeForm" class="add-employee-form">
      <mat-form-field class="field-width">
        <mat-label>Name</mat-label>
        <input
          id="edit-name-field"
          type="text"
          matInput
          placeholder="Name"
          formControlName="name"
        />
      </mat-form-field>
      <mat-form-field class="field-width">
        <mat-label>Payment</mat-label>
        <input
          id="edit-payment-field"
          type="number"
          min="0"
          matInput
          placeholder="Payment"
          formControlName="paymentBigDecimal"
          (input)="checkPayment()"
        />
        <mat-error *ngIf="paymentBigDecimalEditForm?.invalid"
          >Payment must be a postive number!</mat-error
        >
      </mat-form-field>
    </form>
    <button
      id="edit-employee-btn-dialog"
      mat-raised-button
      color="primary"
      (click)="editEmployee()"
      [disabled]="editEmployeeForm.invalid"
    >
      Save
    </button>
  </ng-template>
</div>
